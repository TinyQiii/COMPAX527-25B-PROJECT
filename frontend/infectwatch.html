<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>InfectWatch ‚Äî AI Infection Detector</title>
  <style>
    :root{
      --bg:#f6f8fb;
      --card:#ffffff;
      --muted:#6b7280;
      --primary:#0ea5e9;
      --accent:#0369a1;
      --radius:12px;
      --gap:20px;
      --glass: rgba(255,255,255,0.6);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:#0f172a;
      display:flex;
      min-height:100vh;
      line-height:1.4;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* SIDEBAR */
    .sidebar{
      width:260px;
      background:var(--card);
      padding:24px;
      height:100vh;
      position:fixed;
      left:0;
      top:0;
      box-shadow: 2px 4px 18px rgba(2,6,23,0.06);
      display:flex;
      flex-direction:column;
      gap:18px;
      z-index:10;
    }
    .brand{display:flex;gap:12px;align-items:center}
    .brand .logo{
      width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--primary),var(--accent));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px;
      box-shadow: 0 6px 18px rgba(3,105,161,0.12);
    }
    .brand h1{font-size:18px;margin:0}
    .nav{margin-top:12px;}
    .nav a{
      display:flex;
      gap:12px;
      align-items:center;
      padding:10px;
      color:var(--muted);
      text-decoration:none;
      border-radius:8px;
      margin-bottom:6px;
      transition:all .18s ease;
    }
    .nav a.active, .nav a:hover{
      background:linear-gradient(90deg, rgba(14,165,233,0.08), rgba(3,105,161,0.06));
      color:var(--accent);
      transform:translateX(4px);
    }

    /* MAIN */
    .main{
      margin-left:260px;
      flex:1;
      padding:28px;
      max-width:1200px;
      width:100%;
    }

    header.appbar{
      display:flex;
      gap:16px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:20px;
    }
    .search{position:relative;width:420px}
    .search input{width:100%;padding:10px 14px 10px 38px;border-radius:999px;border:1px solid #e6eef7;background:white}
    .search img{position:absolute;left:12px;top:50%;transform:translateY(-50%);opacity:.7;width:18px}
    .user{display:flex;gap:12px;align-items:center}
    .user img{width:40px;height:40px;border-radius:999px;object-fit:cover}

    /* HERO */
    .hero{
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:28px;
      align-items:center;
      margin-bottom:24px;
    }
    .hero h2{margin:0;font-size:34px;line-height:1.05}
    .hero p{color:var(--muted);margin-top:12px}
    .cta{display:flex;gap:12px;margin-top:18px}
    .btn{
      padding:10px 16px;border-radius:10px;border:none;cursor:pointer;font-weight:700;letter-spacing:0.2px;transition:transform .16s ease, box-shadow .16s ease;
      box-shadow: 0 6px 18px rgba(2,6,23,0.06);
    }
    .btn:focus{outline:3px solid rgba(14,165,233,0.18)}
    .btn.primary{background:var(--accent); color:white}
    .btn.ghost{background:white;border:1px solid #e6eef7;color:var(--accent)}
    .btn:hover{transform:translateY(-4px);box-shadow:0 18px 40px rgba(3,105,161,0.12)}

    .hero-visual{
      background:linear-gradient(180deg, rgba(2,6,23,0.03), rgba(2,6,23,0.01));
      border-radius:14px;height:260px;display:flex;align-items:center;justify-content:center;color:var(--muted);border:1px solid #eef5fb;overflow:hidden;
    }
    .hero-visual img{width:100%;height:100%;object-fit:cover;display:block}

    /* FEATURES */
    .features{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-top:22px}
    .feature-card{
      background:var(--card);padding:14px;border-radius:12px;border:1px solid #f0f6fb;text-align:center;transition:transform .18s ease, box-shadow .18s ease;
    }
    .feature-card img{width:48px;height:48px;margin-bottom:10px}
    .feature-card:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(2,6,23,0.06)}

    /* GRID */
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:var(--gap);margin-top:22px;align-items:start}
    .card{background:var(--card);padding:18px;border-radius:var(--radius);border:1px solid #f0f6fb}
    .map{height:360px;border-radius:10px;background:linear-gradient(90deg,#eef6fb,#f8fbfd);display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:600;overflow:hidden}
    .map img{width:100%;height:100%;object-fit:cover}

    .summary-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px}
    .summary-box{background:linear-gradient(180deg,#fbfdff,#fff);padding:12px;border-radius:10px;text-align:center;transition:transform .18s}
    .summary-box .num{font-size:22px;font-weight:800;color:var(--accent)}
    .summary-box:hover{transform:translateY(-6px)}

    /* recent list */
    .recent-list{margin-top:16px}
    .scan-item{display:flex;gap:12px;padding:10px;border-radius:10px;align-items:center;border:1px dashed #f0f6fb;background:linear-gradient(180deg,#fff,#fbfdff);margin-bottom:10px;transition:background .15s}
    .scan-item:hover{background:linear-gradient(180deg,#fff,#f7feff)}

    /* RIGHT PANEL */
    .right-panel{display:flex;flex-direction:column;gap:var(--gap)}
    .video-item{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    .video-item img{width:110px;height:70px;border-radius:8px;object-fit:cover}

    /* TESTIMONIALS */
    .testimonials{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:18px}
    .testimonial{padding:14px;border-radius:10px;border:1px solid #f0f6fb;background:var(--card);text-align:center;transition:transform .18s,box-shadow .18s}
    .testimonial img{width:60px;height:60px;border-radius:50%;object-fit:cover;margin-bottom:8px}
    .testimonial:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(2,6,23,0.06)}

    /* MODAL */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:flex;align-items:center;justify-content:center;z-index:50;opacity:0;pointer-events:none;transition:opacity .18s}
    .modal-backdrop.open{opacity:1;pointer-events:auto}
    .modal{width:90%;max-width:680px;background:var(--card);border-radius:12px;padding:20px;border:1px solid #e9f4fb;box-shadow:0 40px 90px rgba(2,6,23,0.25)}
    .modal h3{margin-top:0}
    .file-preview{border:1px dashed #e6eef7;padding:14px;border-radius:8px;background:linear-gradient(180deg,#fbfdff,#fff);min-height:86px;display:flex;align-items:center;justify-content:center;color:var(--muted)}

    /* fade-in util */
    .reveal{opacity:0;transform:translateY(20px);transition:opacity .6s ease, transform .6s ease}
    .reveal.visible{opacity:1;transform:none}
    
    /* Loading spinner animation */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Data visualization styles */
    .data-card {
      background: linear-gradient(135deg, #f8fafc, #ffffff);
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .data-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    
    .data-card .value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
      margin: 8px 0;
    }
    
    .data-card .label {
      font-size: 14px;
      color: var(--muted);
      font-weight: 500;
    }
    
    .chart-container {
      position: relative;
      height: 250px;
      background: #fafbfc;
      border-radius: 8px;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .simple-chart {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: end;
      justify-content: space-around;
      gap: 4px;
    }
    
    .chart-bar {
      background: linear-gradient(180deg, var(--primary), var(--accent));
      border-radius: 4px 4px 0 0;
      min-width: 20px;
      transition: all 0.3s ease;
    }
    
    .chart-bar:hover {
      opacity: 0.8;
      transform: scaleY(1.05);
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    
    .data-table th,
    .data-table td {
      padding: 8px 12px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .data-table th {
      background: #f8fafc;
      font-weight: 600;
      color: var(--accent);
    }
    
    .data-table tr:hover {
      background: #f8fafc;
    }
    
    /* Advanced Chart Styles */
    .line-chart {
      position: relative;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #f8fafc, #ffffff);
      border-radius: 8px;
      padding: 16px;
    }
    
    .line-path {
      fill: none;
      stroke: var(--primary);
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      filter: drop-shadow(0 2px 4px rgba(14,165,233,0.2));
    }
    
    .line-dot {
      fill: var(--accent);
      stroke: white;
      stroke-width: 2;
      r: 4;
      transition: all 0.3s ease;
    }
    
    .line-dot:hover {
      r: 6;
      fill: #0ea5e9;
    }
    
    .pie-chart {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .pie-slice {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .pie-slice:hover {
      filter: brightness(1.1);
      transform: scale(1.05);
    }
    
    .pie-legend {
      position: absolute;
      right: 16px;
      top: 16px;
      font-size: 12px;
    }
    
    .pie-legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .pie-legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .area-chart {
      position: relative;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #f8fafc, #ffffff);
      border-radius: 8px;
      padding: 16px;
    }
    
    .area-path {
      fill: url(#areaGradient);
      stroke: var(--primary);
      stroke-width: 2;
      opacity: 0.8;
    }
    
    .scatter-plot {
      position: relative;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #f8fafc, #ffffff);
      border-radius: 8px;
      padding: 16px;
    }
    
    .scatter-dot {
      fill: var(--primary);
      stroke: white;
      stroke-width: 2;
      r: 5;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .scatter-dot:hover {
      r: 8;
      fill: var(--accent);
      filter: drop-shadow(0 2px 8px rgba(14,165,233,0.4));
    }
    
    .doughnut-chart {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .doughnut-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      font-weight: 700;
      color: var(--accent);
    }
    
    .chart-tooltip {
      position: absolute;
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      pointer-events: none;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .chart-tooltip.visible {
      opacity: 1;
    }
    
    .chart-grid {
      stroke: #e2e8f0;
      stroke-width: 1;
      opacity: 0.5;
    }
    
    .chart-axis {
      stroke: #64748b;
      stroke-width: 1;
    }
    
    .chart-label {
      font-size: 11px;
      fill: #64748b;
      text-anchor: middle;
    }

    footer{margin-top:24px}

    /* Responsive */
    @media (max-width: 980px){
      .sidebar{display:none}
      .main{margin-left:20px;padding:18px}
      .hero{grid-template-columns:1fr}
      .features{grid-template-columns:repeat(2,1fr)}
      .grid{grid-template-columns:1fr}
      .testimonials{grid-template-columns:1fr}
    }
    @media (max-width:500px){
      .search{display:none}
      .brand h1{font-size:16px}
      .hero h2{font-size:26px}
      .features{grid-template-columns:1fr}
    }
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <aside class="sidebar" aria-label="Main navigation">
    <div class="brand">
      <div class="logo">IW</div>
      <div>
        <h1>InfectWatch</h1>
        <div style="font-size:12px;color:var(--muted)">AI Infection Detector</div>
      </div>
    </div>

    <nav class="nav" aria-label="Sidebar links">
      <a href="#dashboard" class="active">Dashboard</a>
      <a href="#features">Features</a>
      <a href="#howitworks">How it works</a>
      <a href="#contact">Contact</a>
      <a href="#view" id="viewBtn">View</a>
    </nav>

    <div style="margin-top:auto">
      <small style="color:var(--muted);display:block;margin-bottom:8px">Account</small>
      <div style="display:flex;gap:10px;align-items:center">
        <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="user" style="border-radius:50%;width:44px;height:44px;object-fit:cover">
        <div>
          <div style="font-weight:700">Lab Admin</div>
          <div style="font-size:12px;color:var(--muted)">lab@infectwatch.ai</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <header class="appbar">
      <div style="display:flex;align-items:center;gap:16px">
        <div style="display:flex;flex-direction:column">
          <div style="font-size:12px;color:var(--muted)">Welcome back,</div>
          <div style="font-weight:700">Lab Admin</div>
        </div>
      </div>

      <div style="display:flex;align-items:center;gap:14px">
        <div class="search" aria-hidden="true">
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='11' cy='11' r='7'/><line x1='21' y1='21' x2='16.65' y2='16.65'/></svg>" alt="">
          <input type="text" placeholder="Search scans, patients, reports..." aria-label="Search"/>
        </div>

        <div class="user">
          <button class="btn ghost" id="scanBtn">Scan Now</button>
          <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="profile">
        </div>
      </div>
    </header>

    <!-- HERO -->
    <section id="hero" class="hero reveal">
      <div>
        <h2>AI-powered infection detection ‚Äî fast, secure, trusted</h2>
        <p>Upload samples or images and get an accurate infection analysis in seconds. Built for labs and clinics with end-to-end security and cloud reporting.</p>

        <div class="cta">
          <button class="btn primary" id="scanBtn2">Start Scan</button>
          <button class="btn ghost" id="trialBtn">Request Trial</button>
        </div>

        <!-- feature mini-cards -->
        <div id="features" class="features" aria-hidden="false" style="margin-top:20px">
          <div class="feature-card reveal"><img src="https://img.icons8.com/fluency/48/microscope.png" alt=""><h4>Real-time</h4><p>Instant analysis and alerts.</p></div>
          <div class="feature-card reveal"><img src="https://img.icons8.com/fluency/48/security-checked.png" alt=""><h4>Secure</h4><p>Encrypted storage & audit trails.</p></div>
          <div class="feature-card reveal"><img src="https://img.icons8.com/fluency/48/cloud.png" alt=""><h4>Cloud</h4><p>Seamless deployment options.</p></div>
          <div class="feature-card reveal"><img src="https://img.icons8.com/fluency/48/touchscreen.png" alt=""><h4>User-friendly</h4><p>Minimal steps to results.</p></div>
        </div>
      </div>

      <div class="hero-visual reveal" aria-hidden="false">
        <img src="https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?w=1200&q=80&auto=format&fit=crop" alt="Lab AI analysis">
      </div>
    </section>

    <!-- HOW IT WORKS -->
    <section id="howitworks" class="card reveal" style="margin-top:18px">
      <h3>How it works</h3>
      <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
        <div style="flex:1;min-width:180px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid #eef5fb">
          <strong>1. Upload</strong><p style="color:var(--muted);margin-top:6px">Provide sample or image files.</p>
        </div>
        <div style="flex:1;min-width:180px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid #eef5fb">
          <strong>2. Scan</strong><p style="color:var(--muted);margin-top:6px">Our AI analyzes and flags results.</p>
        </div>
        <div style="flex:1;min-width:180px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid #eef5fb">
          <strong>3. Report</strong><p style="color:var(--muted);margin-top:6px">Download findings or integrate with LIMS.</p>
        </div>
      </div>
    </section>

    <!-- DASHBOARD GRID -->
    <section id="dashboard" class="grid reveal">
      <div>
        <div class="card">
          <h3 style="margin:0 0 20px 0">üåç Global Health Data Dashboard</h3>
          
          <!-- Controls -->
          <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;align-items:center">
            <div>
              <label style="display:block;font-weight:600;margin-bottom:6px;font-size:14px">Country</label>
              <select id="dashboardCountrySelect" style="padding:8px 12px;border-radius:8px;border:1px solid #eef5fb;min-width:150px">
                <option value="">Global</option>
                <option value="CHN">China</option>
                <option value="USA">United States</option>
                <option value="GBR">United Kingdom</option>
                <option value="DEU">Germany</option>
                <option value="FRA">France</option>
                <option value="JPN">Japan</option>
                <option value="IND">India</option>
                <option value="BRA">Brazil</option>
              </select>
            </div>
            
            <div>
              <label style="display:block;font-weight:600;margin-bottom:6px;font-size:14px">Indicator</label>
              <select id="dashboardIndicatorSelect" style="padding:8px 12px;border-radius:8px;border:1px solid #eef5fb;min-width:200px">
                <option value="all">All Indicators</option>
                <option value="covid_cases">COVID-19 Cases</option>
                <option value="covid_deaths">COVID-19 Deaths</option>
                <option value="life_expectancy">Life Expectancy</option>
                <option value="mortality_rate">Mortality Rate</option>
                <option value="tuberculosis">Tuberculosis</option>
                <option value="malaria">Malaria</option>
                <option value="hiv">HIV/AIDS</option>
              </select>
            </div>
            
            <div style="margin-top:20px">
              <button id="dashboardRefreshBtn" class="btn primary">üîÑ Refresh Data</button>
            </div>
          </div>
          
          <!-- Loading indicator -->
          <div id="dashboardLoadingIndicator" style="display:none;text-align:center;padding:20px;color:var(--muted)">
            <div style="display:inline-block;width:20px;height:20px;border:2px solid #eef5fb;border-top:2px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-right:10px"></div>
            Loading WHO data...
          </div>
          
          <!-- Error message -->
          <div id="dashboardErrorMessage" style="display:none;background:#fef2f2;border:1px solid #fecaca;color:#dc2626;padding:12px;border-radius:8px;margin-bottom:20px"></div>
          
          <!-- Summary cards -->
          <div id="dashboardSummaryCards" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:20px"></div>
          
          <!-- Main visualization area -->
          <div id="dashboardVisualization" style="display:none">
            <!-- Charts container -->
            <div id="dashboardChartsContainer" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:20px;margin-bottom:20px">
              <!-- Bar Chart -->
              <div id="dashboardChart1" style="background:white;padding:16px;border-radius:12px;border:1px solid #f0f6fb;min-height:350px">
                <h4 style="margin:0 0 12px 0;color:var(--accent)">üìä Bar Chart</h4>
                <div id="dashboardChart1Content" style="height:300px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Chart will be rendered here</div>
              </div>
              
              <!-- Line Chart -->
              <div id="dashboardChart2" style="background:white;padding:16px;border-radius:12px;border:1px solid #f0f6fb;min-height:350px">
                <h4 style="margin:0 0 12px 0;color:var(--accent)">üìà Line Chart</h4>
                <div id="dashboardChart2Content" style="height:300px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Chart will be rendered here</div>
              </div>
              
              
            </div>
            
            <!-- Data table -->
            <div id="dashboardDataTable" style="background:white;padding:16px;border-radius:12px;border:1px solid #f0f6fb;overflow-x:auto">
              <h4 style="margin:0 0 12px 0;color:var(--accent)">üìã Raw Data</h4>
              <div id="dashboardTableContent" style="font-size:14px;color:var(--muted)">Data table will be rendered here</div>
            </div>
          </div>
        </div>
      </div>

      <aside class="right-panel">
        <div class="card reveal">
          <h3 style="margin:0 0 10px 0">Featured videos</h3>
          <div class="video-item">
            <img src="https://images.unsplash.com/photo-1526256262350-7da7584cf5eb?w=400&q=60&auto=format&fit=crop" alt="video">
            <div>
              <div style="font-weight:700">How InfectWatch works</div>
              <div style="font-size:13px;color:var(--muted)">A short introduction</div>
            </div>
          </div>

          <div class="video-item">
            <img src="https://images.unsplash.com/photo-1524758631624-e2822e304c36?w=400&q=60&auto=format&fit=crop" alt="video">
            <div>
              <div style="font-weight:700">Integrating with LIMS</div>
              <div style="font-size:13px;color:var(--muted)">Step-by-step guide</div>
            </div>
          </div>
        </div>

        <div class="card reveal">
          <h3 style="margin:0 0 10px 0">Testimonials</h3>
          <div class="testimonials">
            <div class="testimonial reveal"><img src="https://randomuser.me/api/portraits/men/32.jpg" alt=""><div><strong>Dr. Lee</strong><div style="color:var(--muted);margin-top:6px">‚ÄúAccuracy and speed are outstanding.‚Äù</div></div></div>
            <div class="testimonial reveal"><img src="https://randomuser.me/api/portraits/women/45.jpg" alt=""><div><strong>Lab Manager</strong><div style="color:var(--muted);margin-top:6px">‚ÄúReduced review time by 70%.‚Äù</div></div></div>
            <div class="testimonial reveal"><img src="https://randomuser.me/api/portraits/men/55.jpg" alt=""><div><strong>IT Lead</strong><div style="color:var(--muted);margin-top:6px">‚ÄúSeamless integration with systems.‚Äù</div></div></div>
          </div>
        </div>

        <div class="card reveal">
          <h3 style="margin:0 0 10px 0">Support</h3>
          <div style="color:var(--muted);font-size:13px">Get help integrating InfectWatch into your workflow, or request a trial.</div>
          <div style="margin-top:12px"><button class="btn primary" style="width:100%">Contact Sales</button></div>
        </div>

      </aside>
    </section>

    <!-- WHO DATA VISUALIZATION SECTION -->
    <section id="view" class="card reveal" style="margin-top:18px;display:none">
      <h3 style="margin:0 0 20px 0">WHO Global Health Data Visualization</h3>
      
      <!-- Controls -->
      <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;align-items:center">
        <div>
          <label style="display:block;font-weight:600;margin-bottom:6px;font-size:14px">Country</label>
          <select id="countrySelect" style="padding:8px 12px;border-radius:8px;border:1px solid #eef5fb;min-width:150px">
            <option value="">Global</option>
            <option value="CHN">China</option>
            <option value="USA">United States</option>
            <option value="GBR">United Kingdom</option>
            <option value="DEU">Germany</option>
            <option value="FRA">France</option>
            <option value="JPN">Japan</option>
            <option value="IND">India</option>
            <option value="BRA">Brazil</option>
          </select>
        </div>
        
        <div>
          <label style="display:block;font-weight:600;margin-bottom:6px;font-size:14px">Indicator</label>
          <select id="indicatorSelect" style="padding:8px 12px;border-radius:8px;border:1px solid #eef5fb;min-width:200px">
            <option value="all">All Indicators</option>
            <option value="covid_cases">COVID-19 Cases</option>
            <option value="covid_deaths">COVID-19 Deaths</option>
            <option value="life_expectancy">Life Expectancy</option>
            <option value="mortality_rate">Mortality Rate</option>
            <option value="tuberculosis">Tuberculosis</option>
            <option value="malaria">Malaria</option>
            <option value="hiv">HIV/AIDS</option>
          </select>
        </div>
        
        <div style="margin-top:20px">
          <button id="loadDataBtn" class="btn primary">Load WHO Data</button>
        </div>
      </div>
      
      <!-- Loading indicator -->
      <div id="loadingIndicator" style="display:none;text-align:center;padding:20px;color:var(--muted)">
        <div style="display:inline-block;width:20px;height:20px;border:2px solid #eef5fb;border-top:2px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-right:10px"></div>
        Loading WHO data...
      </div>
      
      <!-- Error message -->
      <div id="errorMessage" style="display:none;background:#fef2f2;border:1px solid #fecaca;color:#dc2626;padding:12px;border-radius:8px;margin-bottom:20px"></div>
      
      <!-- Data visualization container -->
      <div id="dataVisualization" style="display:none">
        <!-- Summary cards -->
        <div id="summaryCards" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:20px"></div>
        
        <!-- Charts container -->
        <div id="chartsContainer" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:20px;margin-bottom:20px">
          <!-- Bar Chart -->
          <div id="chart1" style="background:white;padding:16px;border-radius:12px;border:1px solid #f0f6fb;min-height:350px">
            <h4 style="margin:0 0 12px 0;color:var(--accent)">üìä Bar Chart</h4>
            <div id="chart1Content" style="height:300px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Chart will be rendered here</div>
          </div>
          
          <!-- Line Chart -->
          <div id="chart2" style="background:white;padding:16px;border-radius:12px;border:1px solid #f0f6fb;min-height:350px">
            <h4 style="margin:0 0 12px 0;color:var(--accent)">üìà Line Chart</h4>
            <div id="chart2Content" style="height:300px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Chart will be rendered here</div>
          </div>
          
          
          
          <!-- Scatter Plot -->
          <div id="chart5" style="background:white;padding:16px;border-radius:12px;border:1px solid #f0f6fb;min-height:350px">
            <h4 style="margin:0 0 12px 0;color:var(--accent)">üîµ Scatter Plot</h4>
            <div id="chart5Content" style="height:300px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Chart will be rendered here</div>
          </div>
          
          <!-- Doughnut Chart -->
          <div id="chart6" style="background:white;padding:16px;border-radius:12px;border:1px solid #f0f6fb;min-height:350px">
            <h4 style="margin:0 0 12px 0;color:var(--accent)">üç© Doughnut Chart</h4>
            <div id="chart6Content" style="height:300px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Chart will be rendered here</div>
          </div>
        </div>
        
        <!-- Data table -->
        <div id="dataTable" style="background:white;padding:16px;border-radius:12px;border:1px solid #f0f6fb;overflow-x:auto">
          <h4 style="margin:0 0 12px 0;color:var(--accent)">Raw Data</h4>
          <div id="tableContent" style="font-size:14px;color:var(--muted)">Data table will be rendered here</div>
        </div>
      </div>
    </section>

    <!-- CONTACT / FOOTER -->
    <footer id="contact" class="card reveal">
      <h3 style="margin-top:0">Contact & Trial</h3>
      <form id="contactForm" style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:12px">
        <input type="text" name="name" placeholder="Name" required style="padding:10px;border-radius:8px;border:1px solid #eef5fb" />
        <input type="email" name="email" placeholder="Email" required style="padding:10px;border-radius:8px;border:1px solid #eef5fb" />
        <input name="message" placeholder="Message" style="padding:10px;border-radius:8px;border:1px solid #eef5fb" />
        <div style="grid-column:1 / -1">
          <button type="submit" class="btn primary">Request demo</button>
        </div>
      </form>
      <div style="margin-top:12px;color:var(--muted);font-size:13px">¬© <span id="yr"></span> InfectWatch ‚Äî Privacy ¬∑ Terms</div>
    </footer>
  </main>

  <!-- MODAL: Scan -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal" role="document" aria-labelledby="scanTitle">
      <h3 id="scanTitle">Start a Demo Scan</h3>
      <p style="color:var(--muted)">Upload an image or sample file and run a demo scan (client-side fake result for preview).</p>

      <div style="display:grid;grid-template-columns:1fr 240px;gap:12px;margin-top:12px">
        <div>
          <label for="fileInput" style="display:block;font-weight:600;margin-bottom:8px">Choose file</label>
          <input id="fileInput" type="file" accept="image/*,.png,.jpg,.jpeg,.csv" />
          <div class="file-preview" id="filePreview" style="margin-top:12px">No file selected</div>
        </div>

        <div>
          <div style="font-weight:700">Demo Settings</div>
          <div style="margin-top:8px;color:var(--muted)">Model</div>
          <select id="modelSelect" style="width:100%;padding:8px;margin-top:6px;border-radius:8px;border:1px solid #eef5fb">
            <option>Standard (fast)</option>
            <option>Clinical (more accurate)</option>
          </select>

          <div style="margin-top:12px">
            <button id="runScan" class="btn primary" style="width:100%">Run Demo Scan</button>
            <button id="closeModal" class="btn ghost" style="width:100%;margin-top:8px">Close</button>
          </div>
        </div>
      </div>

      <div id="scanResult" style="margin-top:12px;display:none">
        <h4>Result</h4>
        <div style="padding:12px;border-radius:8px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid #eef5fb">
          <div id="resultText" style="font-weight:700"></div>
          <div id="resultProb" style="color:var(--muted);margin-top:6px"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  // set year
  document.getElementById('yr').textContent = new Date().getFullYear();

  // Smooth scroll for sidebar links
  document.querySelectorAll('.nav a').forEach(a=>{
    a.addEventListener('click', (e)=>{
      e.preventDefault();
      document.querySelectorAll('.nav a').forEach(x=>x.classList.remove('active'));
      a.classList.add('active');
      const id = a.getAttribute('href').slice(1);
      const el = document.getElementById(id);
      if(el) el.scrollIntoView({behavior:'smooth', block:'start'});
    });
  });

  // Fade-in on scroll using IntersectionObserver
  const io = new IntersectionObserver((entries)=>{
    entries.forEach(ent=>{
      if(ent.isIntersecting) {
        ent.target.classList.add('visible');
        io.unobserve(ent.target);
      }
    });
  }, {root:null,rootMargin:'0px',threshold:0.12});
  document.querySelectorAll('.reveal').forEach(el=>io.observe(el));
  document.querySelectorAll('.feature-card.reveal').forEach(el=>io.observe(el));
  document.querySelectorAll('.testimonial.reveal').forEach(el=>io.observe(el));

  // Animated counters
  function animateCounters() {
    document.querySelectorAll('.num').forEach(el=>{
      const target = +el.getAttribute('data-target') || 0;
      let start = 0;
      const duration = 1200;
      const startTime = performance.now();
      function step(ts){
        const progress = Math.min((ts - startTime)/duration, 1);
        const val = Math.floor(progress * target);
        el.textContent = val;
        if(progress < 1) requestAnimationFrame(step);
        else el.textContent = target;
      }
      requestAnimationFrame(step);
    });
  }
  // Start counters when dashboard visible
  const dashboard = document.getElementById('dashboard');
  const dashObserver = new IntersectionObserver((entries)=>{
    if(entries[0].isIntersecting) { animateCounters(); dashObserver.disconnect(); }
  }, {threshold:0.2});
  if(dashboard) dashObserver.observe(dashboard);

  // Modal logic
  const modal = document.getElementById('modalBackdrop');
  const scanBtn = document.getElementById('scanBtn');
  const scanBtn2 = document.getElementById('scanBtn2');
  const closeModal = document.getElementById('closeModal');
  const runScan = document.getElementById('runScan');
  const fileInput = document.getElementById('fileInput');
  const filePreview = document.getElementById('filePreview');
  const scanResult = document.getElementById('scanResult');
  const resultText = document.getElementById('resultText');
  const resultProb = document.getElementById('resultProb');

  [scanBtn, scanBtn2].forEach(b=>{
    if(b) b.addEventListener('click', openModal);
  });
  function openModal(){ modal.classList.add('open'); modal.setAttribute('aria-hidden','false'); trapFocus(modal); }
  function closeModalFn(){ modal.classList.remove('open'); modal.setAttribute('aria-hidden','true'); releaseFocus(); scanResult.style.display='none'; filePreview.textContent='No file selected'; fileInput.value=''; }

  if(closeModal) closeModal.addEventListener('click', closeModalFn);
  modal.addEventListener('click', (e)=>{ if(e.target === modal) closeModalFn(); });

  // ESC to close
  window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modal.classList.contains('open')) closeModalFn(); });

  // file preview
  fileInput.addEventListener('change', (e)=>{
    const f = e.target.files[0];
    if(!f) { filePreview.textContent = 'No file selected'; return; }
    if(f.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = () => {
        filePreview.innerHTML = '<img src="'+reader.result+'" style="max-width:100%;max-height:120px;border-radius:8px;display:block">';
      };
      reader.readAsDataURL(f);
    } else {
      filePreview.textContent = f.name + ' (' + Math.round(f.size/1024) + ' KB)';
    }
  });

  // Run real scan (calls backend /api/scan)
  runScan.addEventListener('click', async ()=>{
    try {
      runScan.disabled = true;
      runScan.textContent = 'Scanning...';
      const file = fileInput.files && fileInput.files[0];
      if(!file){ alert('Please choose a file'); return; }
      const form = new FormData();
      form.append('file', file);
      form.append('model', (document.getElementById('modelSelect').value || 'standard'));
      const resp = await fetch(`${API_BASE_URL.replace('/api','')}/api/scan`, { method: 'POST', body: form });
      if(!resp.ok){
        const err = await resp.json().catch(()=>({error:'Scan failed'}));
        throw new Error(err.error || `HTTP ${resp.status}`);
      }
      const data = await resp.json();
      const { detected, confidence, filename, processingMs } = data.result || {};
      resultText.textContent = detected ? 'Infection detected' : 'No infection detected';
      resultProb.textContent = `Confidence: ${Math.round((confidence||0)*100)}% ¬∑ File: ${filename||'-'} ¬∑ ${processingMs||0}ms`;
      scanResult.style.display = 'block';
    } catch (e) {
      alert('Scan error: ' + (e.message || e));
    } finally {
      runScan.disabled = false;
      runScan.textContent = 'Run Demo Scan';
    }
  });

  // Contact form demo submit (client-only)
  document.getElementById('contactForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    alert('Thanks ‚Äî demo request received. (This is a client-only demo page.)');
    e.target.reset();
  });

  // small keyboard helper: press 't' to toggle sidebar (preview helper)
  let sidebar = document.querySelector('.sidebar');
  window.addEventListener('keydown', (e)=>{
    if(e.key === 't') {
      if(sidebar.style.display === 'none') sidebar.style.display = 'flex';
      else sidebar.style.display = 'none';
    }
  });

  // Focus trap basic implementation
  let lastFocused = null;
  function trapFocus(container) {
    lastFocused = document.activeElement;
    const focusable = container.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    const first = focusable[0];
    const last = focusable[focusable.length-1];
    first && first.focus();
    function handle(e){
      if(e.key !== 'Tab') return;
      if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
      else if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
    }
    container.__handle = handle;
    document.addEventListener('keydown', handle);
  }
  function releaseFocus(){
    if(document.body.contains(modal)) {
      document.removeEventListener('keydown', modal.__handle);
    }
    lastFocused && lastFocused.focus();
  }

  // accessibility: mark reveal elements as hidden until visible
  document.querySelectorAll('.reveal').forEach(el=>el.setAttribute('aria-hidden','true'));
  const revealObserver = new IntersectionObserver((entries)=>{
    entries.forEach(ent=>{
      if(ent.isIntersecting){ ent.target.classList.add('visible'); ent.target.setAttribute('aria-hidden','false'); revealObserver.unobserve(ent.target); }
    });
  }, {threshold:0.12});
  document.querySelectorAll('.reveal').forEach(el=>revealObserver.observe(el));

  // Dashboard elements
  const dashboardCountrySelect = document.getElementById('dashboardCountrySelect');
  const dashboardIndicatorSelect = document.getElementById('dashboardIndicatorSelect');
  const dashboardRefreshBtn = document.getElementById('dashboardRefreshBtn');
  const dashboardLoadingIndicator = document.getElementById('dashboardLoadingIndicator');
  const dashboardErrorMessage = document.getElementById('dashboardErrorMessage');
  const dashboardVisualization = document.getElementById('dashboardVisualization');
  const dashboardSummaryCards = document.getElementById('dashboardSummaryCards');
  const dashboardChart1Content = document.getElementById('dashboardChart1Content');
  const dashboardChart2Content = document.getElementById('dashboardChart2Content');
  
  const dashboardTableContent = document.getElementById('dashboardTableContent');

  // View section elements
  const viewBtn = document.getElementById('viewBtn');
  const viewSection = document.getElementById('view');
  const loadDataBtn = document.getElementById('loadDataBtn');
  const countrySelect = document.getElementById('countrySelect');
  const indicatorSelect = document.getElementById('indicatorSelect');
  const loadingIndicator = document.getElementById('loadingIndicator');
  const errorMessage = document.getElementById('errorMessage');
  const dataVisualization = document.getElementById('dataVisualization');
  const summaryCards = document.getElementById('summaryCards');
  const chart1Content = document.getElementById('chart1Content');
  const chart2Content = document.getElementById('chart2Content');
  
  const chart5Content = document.getElementById('chart5Content');
  const chart6Content = document.getElementById('chart6Content');
  const tableContent = document.getElementById('tableContent');

  // API Base URL
  const API_BASE_URL = 'http://localhost:3000/api';

  // Dashboard functionality
  function loadDashboardData() {
    console.log('loadDashboardData called');
    const country = dashboardCountrySelect.value;
    const indicator = dashboardIndicatorSelect.value;
    
    console.log('Loading data for country:', country, 'indicator:', indicator);
    
    // Show loading
    dashboardLoadingIndicator.style.display = 'block';
    dashboardErrorMessage.style.display = 'none';
    dashboardVisualization.style.display = 'none';
    dashboardRefreshBtn.disabled = true;
    dashboardRefreshBtn.textContent = 'Loading...';
    
    fetchWHOData(country, indicator)
      .then(data => {
        console.log('Data received:', data);
        displayDashboardData(data, indicator);
      })
      .catch(error => {
        console.error('Error loading dashboard data:', error);
        showDashboardError('Failed to load WHO data: ' + error.message);
      })
      .finally(() => {
        dashboardLoadingIndicator.style.display = 'none';
        dashboardRefreshBtn.disabled = false;
        dashboardRefreshBtn.textContent = 'üîÑ Refresh Data';
      });
  }

  function displayDashboardData(data, indicator) {
    dashboardVisualization.style.display = 'block';
    
    if (indicator === 'all') {
      // Display all indicators
      displayDashboardSummaryCards(data);
      displayDashboardCharts(data);
      displayDashboardTable(data);
    } else {
      // Display specific indicator
      const indicatorData = { [indicator]: data };
      displayDashboardSummaryCards(indicatorData);
      displayDashboardCharts(indicatorData);
      displayDashboardTable(indicatorData);
    }
  }

  function displayDashboardSummaryCards(data) {
    dashboardSummaryCards.innerHTML = '';
    
    Object.entries(data).forEach(([key, value]) => {
      if (value && !value.error) {
        const card = document.createElement('div');
        card.className = 'data-card';
        
        let displayValue = 'N/A';
        let label = key.replace(/_/g, ' ').toUpperCase();
        
        if (value.value && Array.isArray(value.value) && value.value.length > 0) {
          // Get the latest value
          const latestValue = value.value[value.value.length - 1];
          displayValue = latestValue.Value || latestValue.NumericValue || 'N/A';
          
          // Format large numbers
          if (typeof displayValue === 'number' && displayValue > 1000) {
            displayValue = displayValue.toLocaleString();
          }
        }
        
        card.innerHTML = `
          <div class="value">${displayValue}</div>
          <div class="label">${label}</div>
        `;
        
        dashboardSummaryCards.appendChild(card);
      }
    });
  }

  function displayDashboardCharts(data) {
    const indicators = Object.keys(data).filter(key => data[key] && !data[key].error);
    
    // Chart 1: Bar chart
    if (indicators[0]) {
      createBarChart(dashboardChart1Content, data[indicators[0]], indicators[0]);
    } else {
      dashboardChart1Content.innerHTML = '<div style="color:var(--muted)">No data available for chart</div>';
    }
    
    // Chart 2: Line chart
    if (indicators[1]) {
      createLineChart(dashboardChart2Content, data[indicators[1]], indicators[1]);
    } else {
      dashboardChart2Content.innerHTML = '<div style="color:var(--muted)">No data available for chart</div>';
    }
    
    // Pie chart and Area chart removed per request
  }

  function displayDashboardTable(data) {
    let tableHTML = '<table class="data-table"><thead><tr><th>Indicator</th><th>Value</th><th>Date</th><th>Country</th></tr></thead><tbody>';
    
    Object.entries(data).forEach(([key, value]) => {
      if (value && !value.error && value.value && Array.isArray(value.value)) {
        value.value.slice(0, 20).forEach(item => { // Show first 20 rows
          const displayValue = item.Value || item.NumericValue || 'N/A';
          const date = item.TimeDimension || item.Date || 'N/A';
          const country = item.Country || item.SpatialDim || 'Global';
          
          tableHTML += `
            <tr>
              <td>${key.replace(/_/g, ' ').toUpperCase()}</td>
              <td>${displayValue}</td>
              <td>${date}</td>
              <td>${country}</td>
            </tr>
          `;
        });
      }
    });
    
    tableHTML += '</tbody></table>';
    dashboardTableContent.innerHTML = tableHTML;
  }

  function showDashboardError(message) {
    dashboardErrorMessage.textContent = message;
    dashboardErrorMessage.style.display = 'block';
  }

  // Dashboard event listeners
  dashboardRefreshBtn.addEventListener('click', loadDashboardData);
  dashboardCountrySelect.addEventListener('change', loadDashboardData);
  dashboardIndicatorSelect.addEventListener('change', loadDashboardData);

  // Auto-load dashboard data on page load
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, starting dashboard data load...');
    // Wait a bit for the page to fully load
    setTimeout(() => {
      console.log('Loading dashboard data...');
      loadDashboardData();
    }, 1000);
  });

  // View button click handler
  viewBtn.addEventListener('click', (e) => {
    e.preventDefault();
    
    // Update active nav
    document.querySelectorAll('.nav a').forEach(a => a.classList.remove('active'));
    viewBtn.classList.add('active');
    
    // Show view section
    viewSection.style.display = 'block';
    viewSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    
    // Trigger reveal animation
    viewSection.classList.add('visible');
    viewSection.setAttribute('aria-hidden', 'false');
  });

  // Generic function to fetch WHO data
  async function fetchWHOData(country, indicator) {
    const url = `${API_BASE_URL}/who/health-data?country=${country}&indicator=${indicator}`;
    console.log('Fetching from URL:', url);
    
    try {
      const response = await fetch(url);
      console.log('Response status:', response.status);
      
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || `HTTP ${response.status}: Failed to fetch data`);
      }
      
      const data = await response.json();
      console.log('Response data:', data);
      return data.data;
    } catch (error) {
      console.error('Fetch error:', error);
      throw error;
    }
  }

  // Load WHO data for View section
  loadDataBtn.addEventListener('click', async () => {
    const country = countrySelect.value;
    const indicator = indicatorSelect.value;
    
    // Show loading
    loadingIndicator.style.display = 'block';
    errorMessage.style.display = 'none';
    dataVisualization.style.display = 'none';
    loadDataBtn.disabled = true;
    loadDataBtn.textContent = 'Loading...';
    
    try {
      const data = await fetchWHOData(country, indicator);
      displayWHOData(data, indicator);
    } catch (error) {
      console.error('Error loading WHO data:', error);
      showError('Failed to load WHO data: ' + error.message);
    } finally {
      loadingIndicator.style.display = 'none';
      loadDataBtn.disabled = false;
      loadDataBtn.textContent = 'Load WHO Data';
    }
  });

  // Display WHO data
  function displayWHOData(data, indicator) {
    dataVisualization.style.display = 'block';
    
    if (indicator === 'all') {
      // Display all indicators
      displaySummaryCards(data);
      displayCharts(data);
      displayDataTable(data);
    } else {
      // Display specific indicator
      const indicatorData = { [indicator]: data };
      displaySummaryCards(indicatorData);
      displayCharts(indicatorData);
      displayDataTable(indicatorData);
    }
  }

  // Display summary cards
  function displaySummaryCards(data) {
    summaryCards.innerHTML = '';
    
    Object.entries(data).forEach(([key, value]) => {
      if (value && !value.error) {
        const card = document.createElement('div');
        card.className = 'data-card';
        
        let displayValue = 'N/A';
        let label = key.replace(/_/g, ' ').toUpperCase();
        
        if (value.value && Array.isArray(value.value) && value.value.length > 0) {
          // Get the latest value
          const latestValue = value.value[value.value.length - 1];
          displayValue = latestValue.Value || latestValue.NumericValue || 'N/A';
          
          // Format large numbers
          if (typeof displayValue === 'number' && displayValue > 1000) {
            displayValue = displayValue.toLocaleString();
          }
        }
        
        card.innerHTML = `
          <div class="value">${displayValue}</div>
          <div class="label">${label}</div>
        `;
        
        summaryCards.appendChild(card);
      }
    });
  }

  // Display charts
  function displayCharts(data) {
    const indicators = Object.keys(data).filter(key => data[key] && !data[key].error);
    
    // Chart 1: Bar chart
    if (indicators[0]) {
      createBarChart(chart1Content, data[indicators[0]], indicators[0]);
    } else {
      chart1Content.innerHTML = '<div style="color:var(--muted)">No data available for chart</div>';
    }
    
    // Chart 2: Line chart
    if (indicators[1]) {
      createLineChart(chart2Content, data[indicators[1]], indicators[1]);
    } else {
      chart2Content.innerHTML = '<div style="color:var(--muted)">No data available for chart</div>';
    }
    
    // Pie chart and Area chart removed per request
    
    // Chart 5: Scatter plot
    if (indicators[0] && indicators[1]) {
      createScatterPlot(chart5Content, data[indicators[0]], data[indicators[1]], indicators[0], indicators[1]);
    } else {
      chart5Content.innerHTML = '<div style="color:var(--muted)">No data available for chart</div>';
    }
    
    // Chart 6: Doughnut chart
    if (indicators[0]) {
      createDoughnutChart(chart6Content, data[indicators[0]], indicators[0]);
    } else {
      chart6Content.innerHTML = '<div style="color:var(--muted)">No data available for chart</div>';
    }
  }

  // Create bar chart
  function createBarChart(container, data, title) {
    if (!data.value || !Array.isArray(data.value) || data.value.length === 0) {
      container.innerHTML = '<div style="color:var(--muted)">No data points available</div>';
      return;
    }
    const values = data.value.slice(-10);
    const maxValue = Math.max(...values.map(v => v.Value || v.NumericValue || 0));
    const minValue = 0;
    const width = 350;
    const height = 250;
    const padding = 40;
    const chartWidth = width - 2 * padding;
    const chartHeight = height - 2 * padding;

    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', width);
    svg.setAttribute('height', height);
    svg.setAttribute('class', 'line-chart');

    // axes
    const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    yAxis.setAttribute('x1', padding);
    yAxis.setAttribute('y1', padding);
    yAxis.setAttribute('x2', padding);
    yAxis.setAttribute('y2', height - padding);
    yAxis.setAttribute('class', 'chart-axis');
    svg.appendChild(yAxis);
    const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    xAxis.setAttribute('x1', padding);
    xAxis.setAttribute('y1', height - padding);
    xAxis.setAttribute('x2', width - padding);
    xAxis.setAttribute('y2', height - padding);
    xAxis.setAttribute('class', 'chart-axis');
    svg.appendChild(xAxis);

    // grid + y ticks
    const steps = 5;
    for (let i = 0; i <= steps; i++) {
      const y = padding + (chartHeight / steps) * i;
      const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      line.setAttribute('x1', padding);
      line.setAttribute('y1', y);
      line.setAttribute('x2', width - padding);
      line.setAttribute('y2', y);
      line.setAttribute('class', 'chart-grid');
      svg.appendChild(line);

      const tickLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      const tickValue = maxValue - ((maxValue - minValue) / steps) * i;
      tickLabel.textContent = Math.round(tickValue).toString();
      tickLabel.setAttribute('x', padding - 8);
      tickLabel.setAttribute('y', y + 4);
      tickLabel.setAttribute('fill', '#64748b');
      tickLabel.setAttribute('font-size', '10');
      tickLabel.setAttribute('text-anchor', 'end');
      svg.appendChild(tickLabel);
    }

    // bars
    const barSpace = chartWidth / values.length;
    const barWidth = Math.max(8, barSpace * 0.6);
    container.style.position = 'relative';
    const tooltip = document.createElement('div');
    tooltip.className = 'chart-tooltip';
    container.appendChild(tooltip);

    values.forEach((item, index) => {
      const value = item.Value || item.NumericValue || 0;
      const x = padding + barSpace * index + (barSpace - barWidth) / 2;
      const barHeight = (value - minValue) / (maxValue - minValue || 1) * chartHeight;
      const y = padding + chartHeight - barHeight;

      const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
      rect.setAttribute('x', x);
      rect.setAttribute('y', y);
      rect.setAttribute('width', barWidth);
      rect.setAttribute('height', barHeight);
      rect.setAttribute('rx', '4');
      rect.setAttribute('fill', 'url(#lineGradient)');
      rect.addEventListener('mouseenter', () => {
        tooltip.textContent = value.toLocaleString();
        tooltip.classList.add('visible');
      });
      rect.addEventListener('mouseleave', () => tooltip.classList.remove('visible'));
      rect.addEventListener('mousemove', (e) => {
        const rectB = container.getBoundingClientRect();
        tooltip.style.left = (e.clientX - rectB.left + 8) + 'px';
        tooltip.style.top = (e.clientY - rectB.top - 28) + 'px';
      });
      svg.appendChild(rect);

      // value label
      const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      label.textContent = value.toLocaleString();
      label.setAttribute('x', x + barWidth / 2);
      label.setAttribute('y', y - 6);
      label.setAttribute('fill', '#475569');
      label.setAttribute('font-size', '10');
      label.setAttribute('text-anchor', 'middle');
      svg.appendChild(label);
    });

    // x ticks (dates)
    const numXTicks = Math.min(5, values.length);
    for (let i = 0; i < numXTicks; i++) {
      const idx = Math.round((values.length - 1) * (i / (numXTicks - 1)));
      const x = padding + barSpace * idx + barSpace / 2;
      const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      tick.setAttribute('x1', x);
      tick.setAttribute('y1', height - padding);
      tick.setAttribute('x2', x);
      tick.setAttribute('y2', height - padding + 4);
      tick.setAttribute('stroke', '#94a3b8');
      svg.appendChild(tick);

      const dateRaw = values[idx].TimeDimension || values[idx].Date || '';
      const labelText = (dateRaw || '').slice(5, 10) || String(idx + 1);
      const lbl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      lbl.textContent = labelText;
      lbl.setAttribute('x', x);
      lbl.setAttribute('y', height - padding + 14);
      lbl.setAttribute('fill', '#64748b');
      lbl.setAttribute('font-size', '10');
      lbl.setAttribute('text-anchor', 'middle');
      svg.appendChild(lbl);
    }

    // titles
    const yTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    yTitle.textContent = 'Value';
    yTitle.setAttribute('x', 12);
    yTitle.setAttribute('y', height / 2);
    yTitle.setAttribute('fill', '#475569');
    yTitle.setAttribute('font-size', '11');
    yTitle.setAttribute('transform', `rotate(-90 12 ${height / 2})`);
    svg.appendChild(yTitle);
    const xTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    xTitle.textContent = 'Time';
    xTitle.setAttribute('x', width / 2);
    xTitle.setAttribute('y', height - 6);
    xTitle.setAttribute('fill', '#475569');
    xTitle.setAttribute('font-size', '11');
    xTitle.setAttribute('text-anchor', 'middle');
    svg.appendChild(xTitle);

    container.innerHTML = '';
    container.appendChild(svg);
    container.appendChild(tooltip);
  }

  // Create line chart with SVG
  function createLineChart(container, data, title) {
    if (!data.value || !Array.isArray(data.value) || data.value.length === 0) {
      container.innerHTML = '<div style="color:var(--muted)">No data points available</div>';
      return;
    }
    
    const values = data.value.slice(-10);
    const maxValue = Math.max(...values.map(v => v.Value || v.NumericValue || 0));
    const minValue = Math.min(...values.map(v => v.Value || v.NumericValue || 0));
    const range = maxValue - minValue;
    
    const width = 350;
    const height = 250;
    const padding = 40;
    const chartWidth = width - 2 * padding;
    const chartHeight = height - 2 * padding;
    
    // Create SVG
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', width);
    svg.setAttribute('height', height);
    svg.setAttribute('class', 'line-chart');
    
    // Create gradient
    const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
    const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
    gradient.setAttribute('id', 'lineGradient');
    gradient.setAttribute('x1', '0%');
    gradient.setAttribute('y1', '0%');
    gradient.setAttribute('x2', '0%');
    gradient.setAttribute('y2', '100%');
    
    const stop1 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop1.setAttribute('offset', '0%');
    stop1.setAttribute('stop-color', '#0ea5e9');
    const stop2 = document.createElementNS('http://www.w3.org/2000/svg', 'stop');
    stop2.setAttribute('offset', '100%');
    stop2.setAttribute('stop-color', '#0369a1');
    
    gradient.appendChild(stop1);
    gradient.appendChild(stop2);
    defs.appendChild(gradient);
    svg.appendChild(defs);
    
    // Axes
    const yAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    yAxis.setAttribute('x1', padding);
    yAxis.setAttribute('y1', padding);
    yAxis.setAttribute('x2', padding);
    yAxis.setAttribute('y2', height - padding);
    yAxis.setAttribute('class', 'chart-axis');
    svg.appendChild(yAxis);

    const xAxis = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    xAxis.setAttribute('x1', padding);
    xAxis.setAttribute('y1', height - padding);
    xAxis.setAttribute('x2', width - padding);
    xAxis.setAttribute('y2', height - padding);
    xAxis.setAttribute('class', 'chart-axis');
    svg.appendChild(xAxis);

    // Create grid lines
    for (let i = 0; i <= 5; i++) {
      const y = padding + (chartHeight / 5) * i;
      const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      line.setAttribute('x1', padding);
      line.setAttribute('y1', y);
      line.setAttribute('x2', width - padding);
      line.setAttribute('y2', y);
      line.setAttribute('class', 'chart-grid');
      svg.appendChild(line);

      // Y-axis tick labels
      const tickLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      const tickValue = maxValue - (range / 5) * i;
      tickLabel.textContent = Math.round(tickValue).toString();
      tickLabel.setAttribute('x', padding - 8);
      tickLabel.setAttribute('y', y + 4);
      tickLabel.setAttribute('fill', '#64748b');
      tickLabel.setAttribute('font-size', '10');
      tickLabel.setAttribute('text-anchor', 'end');
      svg.appendChild(tickLabel);
    }

    // X-axis ticks and labels (show 5 evenly spaced labels)
    const numXTicks = Math.min(5, values.length);
    for (let i = 0; i < numXTicks; i++) {
      const idx = Math.round((values.length - 1) * (i / (numXTicks - 1)));
      const x = padding + (chartWidth / (values.length - 1)) * idx;
      const tick = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      tick.setAttribute('x1', x);
      tick.setAttribute('y1', height - padding);
      tick.setAttribute('x2', x);
      tick.setAttribute('y2', height - padding + 4);
      tick.setAttribute('stroke', '#94a3b8');
      svg.appendChild(tick);

      const dateRaw = values[idx].TimeDimension || values[idx].Date || '';
      const labelText = (dateRaw || '').slice(5, 10) || String(idx + 1); // MM-DD fallback index
      const lbl = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      lbl.textContent = labelText;
      lbl.setAttribute('x', x);
      lbl.setAttribute('y', height - padding + 14);
      lbl.setAttribute('fill', '#64748b');
      lbl.setAttribute('font-size', '10');
      lbl.setAttribute('text-anchor', 'middle');
      svg.appendChild(lbl);
    }
    
    // Create line path
    let pathData = '';
    values.forEach((item, index) => {
      const value = item.Value || item.NumericValue || 0;
      const x = padding + (chartWidth / (values.length - 1)) * index;
      const y = padding + chartHeight - ((value - minValue) / range) * chartHeight;
      
      if (index === 0) {
        pathData += `M ${x} ${y}`;
      } else {
        pathData += ` L ${x} ${y}`;
      }
    });
    
    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.setAttribute('d', pathData);
    path.setAttribute('class', 'line-path');
    path.setAttribute('stroke', 'url(#lineGradient)');
    svg.appendChild(path);
    
    // Average reference line
    const avg = values.reduce((s, it) => s + (it.Value || it.NumericValue || 0), 0) / values.length;
    const avgY = padding + chartHeight - ((avg - minValue) / range) * chartHeight;
    const avgLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    avgLine.setAttribute('x1', padding);
    avgLine.setAttribute('y1', avgY);
    avgLine.setAttribute('x2', width - padding);
    avgLine.setAttribute('y2', avgY);
    avgLine.setAttribute('stroke', '#94a3b8');
    avgLine.setAttribute('stroke-dasharray', '4,4');
    avgLine.setAttribute('opacity', '0.8');
    svg.appendChild(avgLine);

    const avgLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    avgLabel.textContent = `AVG ${Math.round(avg)}`;
    avgLabel.setAttribute('x', width - padding - 4);
    avgLabel.setAttribute('y', avgY - 4);
    avgLabel.setAttribute('fill', '#64748b');
    avgLabel.setAttribute('font-size', '10');
    avgLabel.setAttribute('text-anchor', 'end');
    svg.appendChild(avgLabel);

    // Create dots
    container.style.position = 'relative';
    const tooltip = document.createElement('div');
    tooltip.className = 'chart-tooltip';
    container.appendChild(tooltip);

    values.forEach((item, index) => {
      const value = item.Value || item.NumericValue || 0;
      const x = padding + (chartWidth / (values.length - 1)) * index;
      const y = padding + chartHeight - ((value - minValue) / range) * chartHeight;
      
      const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      circle.setAttribute('cx', x);
      circle.setAttribute('cy', y);
      circle.setAttribute('class', 'line-dot');
      circle.addEventListener('mouseenter', () => {
        tooltip.textContent = `${value}`;
        tooltip.classList.add('visible');
      });
      circle.addEventListener('mouseleave', () => {
        tooltip.classList.remove('visible');
      });
      circle.addEventListener('mousemove', (e) => {
        const rect = container.getBoundingClientRect();
        tooltip.style.left = (e.clientX - rect.left + 8) + 'px';
        tooltip.style.top = (e.clientY - rect.top - 28) + 'px';
      });
      svg.appendChild(circle);

      // Point label above each dot
      const dotLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text');
      dotLabel.textContent = typeof value === 'number' ? value.toLocaleString() : String(value);
      dotLabel.setAttribute('x', x);
      dotLabel.setAttribute('y', y - 8);
      dotLabel.setAttribute('fill', '#475569');
      dotLabel.setAttribute('font-size', '10');
      dotLabel.setAttribute('text-anchor', 'middle');
      svg.appendChild(dotLabel);
    });
    
    // Axis titles
    const yTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    yTitle.textContent = 'Value';
    yTitle.setAttribute('x', 12);
    yTitle.setAttribute('y', height / 2);
    yTitle.setAttribute('fill', '#475569');
    yTitle.setAttribute('font-size', '11');
    yTitle.setAttribute('transform', `rotate(-90 12 ${height / 2})`);
    svg.appendChild(yTitle);

    const xTitle = document.createElementNS('http://www.w3.org/2000/svg', 'text');
    xTitle.textContent = 'Time';
    xTitle.setAttribute('x', width / 2);
    xTitle.setAttribute('y', height - 6);
    xTitle.setAttribute('fill', '#475569');
    xTitle.setAttribute('font-size', '11');
    xTitle.setAttribute('text-anchor', 'middle');
    svg.appendChild(xTitle);

    container.innerHTML = '';
    container.appendChild(svg);
    container.appendChild(tooltip);
  }

  // Pie chart removed per request
  
  // Area chart removed per request
  
  // Create scatter plot
  function createScatterPlot(container, data1, data2, title1, title2) {
    if (!data1.value || !data2.value || !Array.isArray(data1.value) || !Array.isArray(data2.value)) {
      container.innerHTML = '<div style="color:var(--muted)">No data available for scatter plot</div>';
      return;
    }
    
    const values1 = data1.value.slice(-10);
    const values2 = data2.value.slice(-10);
    const minLength = Math.min(values1.length, values2.length);
    
    if (minLength === 0) {
      container.innerHTML = '<div style="color:var(--muted)">No data points available</div>';
      return;
    }
    
    const width = 350;
    const height = 250;
    const padding = 40;
    const chartWidth = width - 2 * padding;
    const chartHeight = height - 2 * padding;
    
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', width);
    svg.setAttribute('height', height);
    svg.setAttribute('class', 'scatter-plot');
    
    // Create grid
    for (let i = 0; i <= 5; i++) {
      const x = padding + (chartWidth / 5) * i;
      const y = padding + (chartHeight / 5) * i;
      
      const vLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      vLine.setAttribute('x1', x);
      vLine.setAttribute('y1', padding);
      vLine.setAttribute('x2', x);
      vLine.setAttribute('y2', height - padding);
      vLine.setAttribute('class', 'chart-grid');
      svg.appendChild(vLine);
      
      const hLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      hLine.setAttribute('x1', padding);
      hLine.setAttribute('y1', y);
      hLine.setAttribute('x2', width - padding);
      hLine.setAttribute('y2', y);
      hLine.setAttribute('class', 'chart-grid');
      svg.appendChild(hLine);
    }
    
    // Create scatter points
    for (let i = 0; i < minLength; i++) {
      const value1 = values1[i].Value || values1[i].NumericValue || 0;
      const value2 = values2[i].Value || values2[i].NumericValue || 0;
      
      const x = padding + (value1 / Math.max(...values1.map(v => v.Value || v.NumericValue || 0))) * chartWidth;
      const y = padding + chartHeight - (value2 / Math.max(...values2.map(v => v.Value || v.NumericValue || 0))) * chartHeight;
      
      const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
      circle.setAttribute('cx', x);
      circle.setAttribute('cy', y);
      circle.setAttribute('class', 'scatter-dot');
      circle.setAttribute('title', `X: ${value1}, Y: ${value2}`);
      svg.appendChild(circle);
    }
    
    container.innerHTML = '';
    container.appendChild(svg);
  }
  
  // Create doughnut chart
  function createDoughnutChart(container, data, title) {
    if (!data.value || !Array.isArray(data.value) || data.value.length === 0) {
      container.innerHTML = '<div style="color:var(--muted)">No data points available</div>';
      return;
    }
    
    const values = data.value.slice(-5); // Top 5 values
    const total = values.reduce((sum, item) => sum + (item.Value || item.NumericValue || 0), 0);
    
    if (total === 0) {
      container.innerHTML = '<div style="color:var(--muted)">No valid data for doughnut chart</div>';
      return;
    }
    
    const width = 300;
    const height = 300;
    const outerRadius = Math.min(width, height) / 2 - 20;
    const innerRadius = outerRadius * 0.6;
    const centerX = width / 2;
    const centerY = height / 2;
    
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('width', width);
    svg.setAttribute('height', height);
    svg.setAttribute('class', 'doughnut-chart');
    
    const colors = ['#0ea5e9', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
    
    let currentAngle = 0;
    values.forEach((item, index) => {
      const value = item.Value || item.NumericValue || 0;
      const percentage = value / total;
      const angle = percentage * 2 * Math.PI;
      
      const x1 = centerX + outerRadius * Math.cos(currentAngle);
      const y1 = centerY + outerRadius * Math.sin(currentAngle);
      const x2 = centerX + outerRadius * Math.cos(currentAngle + angle);
      const y2 = centerY + outerRadius * Math.sin(currentAngle + angle);
      
      const x3 = centerX + innerRadius * Math.cos(currentAngle + angle);
      const y3 = centerY + innerRadius * Math.sin(currentAngle + angle);
      const x4 = centerX + innerRadius * Math.cos(currentAngle);
      const y4 = centerY + innerRadius * Math.sin(currentAngle);
      
      const largeArcFlag = angle > Math.PI ? 1 : 0;
      
      const pathData = [
        `M ${x1} ${y1}`,
        `A ${outerRadius} ${outerRadius} 0 ${largeArcFlag} 1 ${x2} ${y2}`,
        `L ${x3} ${y3}`,
        `A ${innerRadius} ${innerRadius} 0 ${largeArcFlag} 0 ${x4} ${y4}`,
        'Z'
      ].join(' ');
      
      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
      path.setAttribute('d', pathData);
      path.setAttribute('fill', colors[index % colors.length]);
      path.setAttribute('class', 'pie-slice');
      path.setAttribute('title', `${(percentage * 100).toFixed(1)}%`);
      svg.appendChild(path);
      
      currentAngle += angle;
    });
    
    // Add center text
    const centerText = document.createElement('div');
    centerText.className = 'doughnut-center';
    centerText.innerHTML = `
      <div style="font-size: 18px;">${total.toLocaleString()}</div>
      <div style="font-size: 12px; color: var(--muted);">Total</div>
    `;
    
    container.innerHTML = '';
    container.appendChild(svg);
    container.appendChild(centerText);
  }

  // Display data table
  function displayDataTable(data) {
    let tableHTML = '<table class="data-table"><thead><tr><th>Indicator</th><th>Value</th><th>Date</th><th>Country</th></tr></thead><tbody>';
    
    Object.entries(data).forEach(([key, value]) => {
      if (value && !value.error && value.value && Array.isArray(value.value)) {
        value.value.slice(0, 20).forEach(item => { // Show first 20 rows
          const displayValue = item.Value || item.NumericValue || 'N/A';
          const date = item.TimeDimension || item.Date || 'N/A';
          const country = item.Country || item.SpatialDim || 'Global';
          
          tableHTML += `
            <tr>
              <td>${key.replace(/_/g, ' ').toUpperCase()}</td>
              <td>${displayValue}</td>
              <td>${date}</td>
              <td>${country}</td>
            </tr>
          `;
        });
      }
    });
    
    tableHTML += '</tbody></table>';
    tableContent.innerHTML = tableHTML;
  }

  // Show error message
  function showError(message) {
    errorMessage.textContent = message;
    errorMessage.style.display = 'block';
  }

</script>
</body>
</html>
